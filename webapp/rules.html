<!DOCTYPE html>
<html>

<head>
    <title>知识管理系统</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/font-awesome.min.css" rel="stylesheet" media="screen">
    <link href="css/codemirror.css" rel="stylesheet" media="screen">
    <link href="css/qonsole.css" rel="stylesheet" media="screen">
    <link href="css/jquery.dataTables.css" rel="stylesheet" media="screen">
    <link href="css/fui.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap-theme.min.css" rel="stylesheet" media="screen">
    <!-- <script data-main="js/app/main.rules.js" src="js/lib/require.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/3.2.3/echarts.min.js"></script>

    <!--[if lt IE 9]>
    <script src="js/lib/html5shiv.js"></script>
    <script src="js/lib/respond.min.js"></script>
    <![endif]-->


</head>

<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="row">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">
                    <img src="images/jena-logo-notext-small.png" alt="Apache Jena logo" title="Apache Jena"/>
                    <!--<div>Apache<br/>Jena<br/><strong>Fuseki</strong></div>-->
                    <div>知识<br/>管理<br/>系统</div>
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="index.html"><i class="fa fa-home"></i></a></li>
                    <li class=""><a href="dataset.html"><i class="fa fa-database"></i> 数据集</a></li>
                    <li class=""><a href="manage.html"><i class="fa fa-cogs"></i> 管理数据集 </a></li>
                    <li class=""><a href="rules.html"><i class="fa fa-cogs"></i> 规则定义</i></a></li>
                    <!-- JENA-887 not yet implemented
                <li class=""><a href="services.html"><i class="fa fa-wrench"></i> services</a></li>
                -->
                    <li class=""><a href="documentation.html"><i class="fa fa-info-circle"></i> 帮助 </a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="status-indicator">
                        <div>服务器<br/>状态:</div>
                    </li>
                    <li class="status-indicator">
                        <a class="" href="#admin/server-log.html" id="server-status-light"
                           title="current server status">
                            <span class="server-up"></span>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</nav>


<div class="container">
    <table class="row">
        <div class="page-header">
            <h2><i class="fa fa-info-circle"></i>定义事件处理规则:</h2>
            <p class="lead"></p>
        </div>
        <!--<h3>Three equal columns</h3>-->
        <!--<p>Get three equal-width columns <strong>starting at desktops and scaling to large desktops</strong>. On-->
        <!--mobile devices, tablets and below, the columns will automatically stack.</p>-->
        <div>
            <h2>事件schema</h2>
            <div class='schema'>

                <form id="formID" role="form">
                    <div class="form-group">
                        <label for="road">街道</label>
                        <select name="road" class="form-control" id="road">
                            <option>翠竹路</option>
                            <option>红岭中路</option>
                            <option>福中路</option>
                            <option>金田路</option>
                        </select>
                    </div>
                    <!--<div class="form-group">-->
                        <!--<label for="time">时间段</label>-->
                        <!--<select name="time" class="form-control" id="time">-->
                            <!--<option>2011/04/25 00:00:00 - 2011/04/25 00:10:00</option>-->
                            <!--<option>2011/04/25 03:00:00 - 2011/04/25 03:10:00</option>-->
                            <!--<option>2011/04/25 07:30:00 - 2011/04/25 07:40:00</option>-->
                            <!--<option>2011/04/25 10:00:00 - 2011/04/25 10:10:00</option>-->
                            <!--<option>2011/04/25 12:00:00 - 2011/04/25 12:10:00</option>-->
                            <!--<option>2011/04/25 17:00:00 - 2011/04/25 17:10:00</option>-->
                            <!--<option>2011/04/25 17:30:00 - 2011/04/25 17:35:00</option>-->
                            <!--<option>2011/04/25 17:35:00 - 2011/04/25 17:40:00</option>-->
                            <!--<option>2011/04/25 18:00:00 - 2011/04/25 18:10:00</option>-->
                            <!--<option>2011/04/25 20:00:00 - 2011/04/25 20:10:00</option>-->
                            <!--<option>2011/04/25 22:30:00 - 2011/04/25 22:40:00</option>-->
                        <!--</select>-->
                        <!--&lt;!&ndash;<input name="time" type="input" class="form-control" id="time" placeholder="">&ndash;&gt;-->
                    <!--</div>-->
                    <div class="form-group">
                        <label for="topic">主题</label>
                        <input name="topic" type="input" class="form-control" id="topic" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="severe">严重拥堵定义：缓速车量比例</label>
                        <input name="severe" class="form-control" id="severe">
                    </div>
                    <div class="form-group">
                        <label for="conjection" >拥堵定义：缓速车量比例</label>
                        <input name="conjection" class="form-control" id="conjection">
                    </div>
                    <div class="form-group">
                        <label for="slightConjection">轻微拥堵定义：缓速车量比例</label>
                        <input name="slightConjection" class="form-control" id="slightConjection">
                        <!--<select name="slightConjection" class="form-control" id="slightConjection">-->
                            <!--<option>轻微拥堵 = (and (>= (* valid 100) (* 40 carsInRoad)) (>= carsInRoad 20))</option>-->
                        <!--</select>-->
                    </div>
                    <div class="form-group">
                        <label for="min">最小数据量</label>
                        <input name="min" type="input" class="form-control" id="min" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="speed">缓速阈值定义</label>
                        <input name="speed" class="form-control" id="speed">
                    </div>
                    <!--<div class="form-group">-->
                        <!--<input name="target-txt" type="input" class="form-control" id="target-txt" placeholder="">-->
                    <!--</div>-->

                    <!-- for file input -->
                    <!--<div class="form-group">-->
                    <!--<label for="exampleInputFile">File input</label>-->
                    <!--<input name="file" type="file" id="exampleInputFile">-->
                    <!--&lt;!&ndash; <p class="help-block">Example block-level help text here.</p> &ndash;&gt;-->
                    <!--</div>-->

                    <!-- <div class="checkbox">
                        <label>
                            <input type="checkbox"> Check me out  ∀ ∃
                        </label>
                    </div> -->

                </form>
                <button id="sub" class="btn btn-default">Submit</button>
                <button id="results" class="btn btn-default">show results</button>
                <div id="main" style="width: 600px;height:400px;"></div>


                <!-- <div class="row">
                    <a class="col-md-3"></a>
                    <h2 class="col-mmd-9">文本定义<h2>
                    <textarea class="col-md-10 pre-scrollable"></textarea>
                </div> -->
            </div>

        </div>
    </table>
</div>

<script type="text/javascript">

    var id = 1;
    var result = 1;
    $("#sub").click(function (e) {
        // alert("clicked sub button")
        var params = $('#formID').serialize();
        params["id"] = id++;
        $.post('http://localhost:15100/deduce', params, function () {
            // 可以做一些渲染
        });
    });

    var buffer = [];
    var times = [];

    function processTime(t) {
        var date = new Date();
        date.setTime(t);
        return date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
    }

    var links = buffer.map(function (item, i) {
        return {
            source: i,
            target: i + 1
        };
    });

    option = {
        title: {
            text: '道路拥堵状态'
        },
        xAxis: {
            type: 'category',
            data: times,
            splitLine: {
                show: false
            }
        },
        yAxis: {
//            type: 'value',
////            boundaryGap: [0, '100%'],
//            splitLine: {
//                show: false
//            }
        },
//        series: [{
//            name: '数据',
//            type: 'line',
//            showSymbol: false,
//            hoverAnimation: false,
//            data: buffer
//        }]
        series: [
            {
                type: 'graph',
                layout: 'none',
                coordinateSystem: 'cartesian2d',
                symbolSize: 30,
                label: {
                    normal: {
                        show: false
                    }
                },
                edgeSymbol: ['circle', 'arrow'],
                edgeSymbolSize: [4, 10],
                data: buffer,
                links: links,
                lineStyle: {
                    normal: {
                        color: '#2f4554'
                    }
                }
            }
        ]
    };


    $("#results").click(function (e) {
        buffer = [];
        times = [];

        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);

        var params = {};
        params["id"] = result;

        var timer = setInterval(function () {
            $.post('http://localhost:15100/data', params, function (result) {
                if (result["value"] == null) {
                    clearTimeout(timer);
                }
                buffer.push(result["value"]);
                times.push(processTime(result["time"]));
            });

            var links = buffer.map(function (item, i) {
                return {
                    source: i,
                    target: i + 1
                };
            });
            if (buffer.length > 7) {
                buffer.shift();
                times.shift();
                links.pop();
            }
            var links = buffer.map(function (item, i) {
                return {
                    source: i,
                    target: i + 1
                };
            });

            myChart.setOption({
                xAxis: {
                    data: times
                },
                series: [{
                    links: links,
                    data: buffer
                }]
            });
        }, 1000);

    });

</script>
</body>

</html>
